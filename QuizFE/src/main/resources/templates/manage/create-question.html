<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="fragments :: head/meta"></th:block>
    <th:block th:insert="fragments :: head/link"></th:block>

    <!--begin::Page Custom Styles(used by this page) -->
    <link th:href="@{/css/pages/wizard/wizard-1.css}" rel="stylesheet" type="text/css" />
    <!--end::Page Custom Styles -->

    <title>Quiz App | Create Question</title>
</head>

<!-- end::Head -->

<!-- begin::Body -->
<body th:style="'background-image: url(' + @{/media/demos/demo8/bg-1.jpg} + ');'"
      class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--enabled kt-subheader--transparent kt-page--loading">

<!-- begin:: Page -->

<!-- begin:: Header Mobile -->
<div th:replace="fragments :: header-mobile"></div>
<!-- end:: Header Mobile -->

<div class="kt-grid kt-grid--hor kt-grid--root">
    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">
        <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">

            <!-- begin:: Header -->
            <div th:replace="fragments :: header"></div>
            <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-grid--stretch">
                <div class="kt-body kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-grid--stretch"
                     id="kt_body">
                    <div class="kt-content  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">

                        <!-- begin:: Subheader -->
                        <div class="kt-subheader   kt-grid__item" id="kt_subheader">
                            <div class="kt-container  kt-container--fluid ">
                                <div class="kt-subheader__main">
                                    <h3 class="kt-subheader__title">
                                        Manage </h3>
                                    <span class="kt-subheader__separator kt-hidden"></span>
                                    <div class="kt-subheader__breadcrumbs">
                                        <a href="#" class="kt-subheader__breadcrumbs-home"><i
                                                class="flaticon2-shelter"></i></a>
                                        <span class="kt-subheader__breadcrumbs-separator"></span>
                                        <a href="" class="kt-subheader__breadcrumbs-link">
                                            Create Question</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end:: Subheader -->

                        <!-- begin:: Content -->
                        <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">
                            <div class="d-flex justify-content-center">
                                <div class="col-md-9">
                                    <div class="kt-portlet">
                                        <div class="kt-portlet__head">
                                            <div class="kt-portlet__head-label">
												<span class="kt-portlet__head-icon kt-hidden">
													<i class="la la-gear"></i>
												</span>
                                                <h3 class="kt-portlet__head-title">
                                                    Create Question
                                                </h3>
                                            </div>
                                        </div>
                                        <!--begin::Form-->
                                        <form class="kt-form" th:action="@{/manage/add-question}" id="form-add_question" th:fragment="addQuestion">
                                            <div class="form-group">
                                                <div class="font-weight-bold d-block text-center" id="error-question"></div>
                                                <div class="font-weight-bold d-block text-center" id="success-question"></div>
                                            </div>
                                            <div class="kt-portlet__body">
                                                <div class="kt-form__section kt-form__section--first">
                                                    <input type="hidden" id="userId" th:value="${memberObject?.id}">
                                                    <input type="hidden" id="questId" value="">
                                                    <div class="form-group row">
                                                        <label class="col-lg-2 col-form-label">Question detail:</label>
                                                        <div class="col-lg-9">
                                                            <div class="summernote" id="kt_summernote_1"></div>
                                                            <span class="invalid-feedback"></span>
                                                        </div>
                                                    </div>
                                                    <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                                    <div id="kt_repeater_1">
                                                        <div class="form-group form-group-last row" id="kt_repeater_1">
                                                            <label class="col-lg-2 col-form-label">Choices:</label>
                                                            <div data-repeater-list="" class="col-lg-10" id="answerRow">
                                                                <div data-repeater-item class="form-group row align-items-center">
                                                                    <div class="col-md-6">
                                                                        <div class="kt-form__group--inline">
                                                                            <div class="kt-form__control">
                                                                                <input type="text" class="form-control answer" placeholder="Enter choice question">
                                                                            </div>
                                                                        </div>
                                                                        <div class="d-md-none kt-margin-b-10"></div>
                                                                    </div>
                                                                    <div class="col-md-2">
                                                                        <div class="kt-radio-inline">
                                                                            <label class="kt-checkbox kt-checkbox--success kt-checkbox--state-success">
                                                                                <input type="checkbox" class="correct-answer"> Correct Answer
                                                                                <span></span>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <a href="javascript:;" data-repeater-delete class="btn-sm btn btn-label-danger btn-bold">
                                                                            <i class="la la-trash-o"></i>
                                                                            Delete
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group form-group-last row">
                                                            <label class="col-lg-2 col-form-label"></label>
                                                            <div class="col-lg-4">
                                                                <a href="javascript:;" data-repeater-create class="btn btn-bold btn-sm btn-label-brand">
                                                                    <i class="la la-plus"></i> Add more choice
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="kt-separator kt-separator--border-dashed kt-separator--space-lg"></div>
                                                    <div class="form-group row">
                                                        <label class="col-lg-2 col-form-label">Assign Topic:</label>
                                                        <div class="col-xl-8 col-lg-8 col-sm-12 col-md-12">
                                                            <div class="kt-checkbox-inline">
                                                                <label class="kt-checkbox" th:each="topic : ${listTopic}">
                                                                    <input type="checkbox" class="topic" th:value="${topic?.getTopicName()}">[[${topic?.topicName}]]
                                                                    <span></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="kt-portlet__foot">
                                                <div class="kt-form__actions">
                                                    <div class="row">
                                                        <div class="col-lg-2"></div>
                                                        <div class="col-lg-2">
                                                            <button type="submit" id="btn-add_question" class="btn btn-success">Submit</button>
                                                            <button type="reset" class="btn btn-secondary" id="btn-cancel">Cancel
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <!--end::Form-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end:: Content -->
                    </div>
                </div>
            </div>

            <!-- begin:: Footer -->
            <div th:replace="fragments :: footer"></div>
            <!-- end:: Footer -->
        </div>
    </div>
</div>
<!-- end:: Page -->
<th:block th:insert="fragments :: body/script"></th:block>
<script th:src="@{/js/pages/crud/forms/widgets/form-repeater.js}" type="text/javascript"></script>
<script th:src="@{/js/pages/crud/forms/editors/summernote.js}" type="text/javascript"></script>
<script th:src="@{/js/pages/crud/forms/widgets/select2.js}" type="text/javascript"></script>
<script th:src="@{/js/validator.js}" type="text/javascript"></script>
<script>
    $(function() {
        $(document).on('click', '#btn-add_question', function (e) {
            e.preventDefault();
            let answer = $('.answer');
            let map = {};
            let arr = $.map(answer, function (e) {
                return e.value;
            })
            let arrCorrect = $.map($('.correct-answer'), function(e) {
                return e.checked;
            })
            let arrTopic = $.map($('.topic'), function(e) {
                if (e.checked) {
                    return e.value;
                }
            })
            for (let i = 0; i < answer.length; i++) {
                map[arr[i]] = arrCorrect[i];
            }

            let data = {
                id : $('#userId').val(),
                question : $('.note-editable p').text(),
                listAnswer : map,
                listTopic : arrTopic,
            }
            $.ajax({
                url: $('#form-add_question').attr('action'),
                contentType: 'application/json',
                type: 'POST',
                data: JSON.stringify(data),
                success: function(result) {
                    alert('check')
                    if (result === 'CREATE') {
                        $('#success-question').addClass('alert alert-success').html("CREATE NEW QUESTION SUCCESSFUL");
                    } else {
                        $('#error-question').addClass('alert alert-danger').html(result);
                    }
                }
            });

        })
    });
    /* Validate form */
    Validator({
        form: '#form-add_question',
        errorSelector: '.invalid-feedback',
        rules: [
            Validator.isRequired('#kt_summernote_1')
        ]
    });
</script>
</body>
<!-- end::Body -->
</html>